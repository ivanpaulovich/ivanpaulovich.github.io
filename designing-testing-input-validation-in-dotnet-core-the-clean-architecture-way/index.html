<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>Designing and Testing Input Validation in .NET Core: The Clean Architecture way | Paulovich.NET</title>

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Designing and Testing Input Validation in .NET Core: The Clean Architecture way | Software Architecture and .NET Development</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Designing and Testing Input Validation in .NET Core: The Clean Architecture way" />
<meta name="author" content="ivanpaulovich" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Almost every software requires some input validation implementation. Due to the importance there are frameworks and guidelines to help us complete the task, should not be difficult to write good validation code right?" />
<meta property="og:description" content="Almost every software requires some input validation implementation. Due to the importance there are frameworks and guidelines to help us complete the task, should not be difficult to write good validation code right?" />
<meta property="og:site_name" content="Software Architecture and .NET Development" />
<meta property="og:image" content="/assets/images/norman-tsui-PoF0kgQm9hE-unsplash.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-09-07T04:12:52+00:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Designing and Testing Input Validation in .NET Core: The Clean Architecture way","dateModified":"2019-09-07T04:12:52+00:00","datePublished":"2019-09-07T04:12:52+00:00","image":"/assets/images/norman-tsui-PoF0kgQm9hE-unsplash.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"/designing-testing-input-validation-in-dotnet-core-the-clean-architecture-way/"},"url":"/designing-testing-input-validation-in-dotnet-core-the-clean-architecture-way/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/logo.png"},"name":"ivanpaulovich"},"author":{"@type":"Person","name":"ivanpaulovich"},"description":"Almost every software requires some input validation implementation. Due to the importance there are frameworks and guidelines to help us complete the task, should not be difficult to write good validation code right?","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="Paulovich.NET">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Paulovich.NET</h1>
    <p class="lead">
        Software Architecture and .NET Development
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Designing and Testing Input Validation in .NET Core: The Clean Architecture way&url=https://paulovich.net/designing-testing-input-validation-in-dotnet-core-the-clean-architecture-way/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=https://paulovich.net/designing-testing-input-validation-in-dotnet-core-the-clean-architecture-way/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://paulovich.net/designing-testing-input-validation-in-dotnet-core-the-clean-architecture-way/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="https://www.gravatar.com/avatar/8821ecd598e75afc5f9f33eac6cabb0d?s=250&d=mm&r=x" alt="Ivan Paulovich">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://paulovich.net">Ivan Paulovich</a><a target="_blank" href="https://twitter.com/ivanpaulovich" class="btn follow">Follow</a>
                        <span class="author-description">Agile .NET developer focused on Clean architecture. I enjoy implementing solutions based on use cases and decoupled from technology details.</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Designing and Testing Input Validation in .NET Core: The Clean Architecture way</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid lazyimg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=" data-src="/assets/images/norman-tsui-PoF0kgQm9hE-unsplash.jpg" alt="Designing and Testing Input Validation in .NET Core: The Clean Architecture way">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                <!-- End Toc -->
                <p>Almost every software requires some input validation implementation. Due to the importance there are frameworks and guidelines to help us complete the task, should not be difficult to write good validation code right?</p>

<p>Wrong! Validation is the most common source of issues in Web applications. Let me explain the code smells:</p>

<ul>
  <li><strong>Untestable Validation Code:</strong> To test the validation logic it is required to write tests against the whole universe of combinations, it is not practical.</li>
  <li><strong>Mixed Validation Code:</strong> Every method is concerned about input validation. Complexity increases on every new feature added.</li>
  <li><strong>Business Logic dependent on Frameworks:</strong> Too much business code wrote using frameworks. What if we need to change the framework?</li>
</ul>

<p>Have you seen bad code like this?</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre>
<span class="k">public</span> <span class="k">void</span> <span class="nf">RegisterCustomer</span><span class="p">(</span>
        <span class="kt">string</span> <span class="n">ssn</span><span class="p">,</span>
        <span class="kt">string</span> <span class="n">name</span><span class="p">,</span>
        <span class="kt">double</span> <span class="n">initialAmount</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">ssn</span><span class="p">))</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">SSNShouldNotBeEmptyException</span><span class="p">(</span><span class="s">"The 'ssn' field is required"</span><span class="p">);</span>

    <span class="n">Regex</span> <span class="n">regex</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Regex</span><span class="p">(</span><span class="n">RegExForValidation</span><span class="p">);</span>
    <span class="n">Match</span> <span class="n">match</span> <span class="p">=</span> <span class="n">regex</span><span class="p">.</span><span class="nf">Match</span><span class="p">(</span><span class="n">ssn</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(!</span><span class="n">match</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidSSNException</span><span class="p">(</span><span class="s">"Invalid SSN format. Use YYMMDDNNNN."</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NameShouldNotBeEmptyException</span><span class="p">(</span><span class="s">"The 'name' field is required"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">value</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">AmountShouldBePositiveException</span><span class="p">(</span><span class="s">"The 'Amount' should be positive."</span><span class="p">);</span>

    <span class="c1">//</span>
    <span class="c1">// other logic implementation omitted</span>
    <span class="c1">//</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Read the next topics to learn how to cure this anaemia or navigate to <a href="https://paulovich.net/guidelines-to-enrich-anemic-domain-models-tdd-ddd/">Guidelines to Enrich Anemic Domain Models with TDD/DDD</a> for more examples.</p>

<h2 id="what-i-suggest-you-to-do">What I suggest you to do?</h2>

<p>I suggest that we take leverage of frameworks and still write testable code. I would describe the steps as following:</p>

<ol>
  <li>Validate the required fields and types in isolation.</li>
  <li>Validate the fields values format (e-mail, phone number, personnummer).</li>
  <li>Validate if the combination of fields are valid.</li>
</ol>

<p>Suppose that a system manages the Customer’s Wallet Account. The first use case is <code class="highlighter-rouge">Register a Customer</code>, let’s see how would be the validation steps:</p>

<h3 id="1-validating-fields-in-isolation-with-data-annotations">1. Validating fields in isolation with Data Annotations</h3>

<p>The Web layer is responsible for many things, we do not want to flood the Web with business logic. Let’s keep the framework dependencies under control.</p>

<p>So I would add only the <code class="highlighter-rouge">[Required]</code> attribute here. The benefit is that these attributes are automatically read by the ASP.NET framework for built in validation. The other benefit is that Swagger extensions use this information to generate the API description, it is too many benefits to avoid Data Annotations.</p>

<p>The rule is:</p>

<blockquote>
  <p>Keep it simple.</p>
</blockquote>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">RegisterRequest</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// SSN</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">SSN</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// Name</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// Initial Amount</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">InitialAmount</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The immediate benefit is that Validation is built in ASP.NET Core, completely integrated with Swagger (Open API Specification).</p>

<p><img src="/assets/img/bad-request.png" alt="Feature Envy Fixed" /></p>

<h3 id="2-validating-fields-format-in-the-domain-layer">2. Validating fields format in the Domain Layer</h3>

<p>Fields data format validation is a business concern. For that reason I want them to be implemented in the Domain layer. My suggestion is that you add a folder for Value Objects with classes like this:</p>

<p>In Sweden the <code class="highlighter-rouge">Social Security Number</code> is called <code class="highlighter-rouge">Personnummer</code> and the format is YYMMDDNNNN.</p>

<ul>
  <li>As instance of SSN only exists if it is valid.</li>
  <li>It is immutable (without methods changing the <code class="highlighter-rouge">_text</code> property.</li>
  <li>It is serializable.</li>
  <li>It is unique by its internal property values.</li>
</ul>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">SSN</span> <span class="p">:</span> <span class="n">IEquatable</span><span class="p">&lt;</span><span class="n">SSN</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">_text</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">string</span> <span class="n">RegExForValidation</span> <span class="p">=</span> <span class="s">@"^\d{6,8}[-|(\s)]{0,1}\d{4}$"</span><span class="p">;</span>

    <span class="k">private</span> <span class="nf">SSN</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">SSN</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">SSNShouldNotBeEmptyException</span><span class="p">(</span><span class="s">"The 'SSN' field is required"</span><span class="p">);</span>

        <span class="n">Regex</span> <span class="n">regex</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Regex</span><span class="p">(</span><span class="n">RegExForValidation</span><span class="p">);</span>
        <span class="n">Match</span> <span class="n">match</span> <span class="p">=</span> <span class="n">regex</span><span class="p">.</span><span class="nf">Match</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(!</span><span class="n">match</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidSSNException</span><span class="p">(</span><span class="s">"Invalid SSN format. Use YYMMDDNNNN."</span><span class="p">);</span>

        <span class="n">_text</span> <span class="p">=</span> <span class="n">text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">string</span> <span class="nf">ToString</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">SSN</span> <span class="n">other</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">_text</span> <span class="p">==</span> <span class="n">other</span><span class="p">.</span><span class="n">_text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">ReferenceEquals</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nf">ReferenceEquals</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="k">is</span> <span class="kt">string</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">obj</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">==</span> <span class="n">_text</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">((</span><span class="n">SSN</span><span class="p">)</span> <span class="n">obj</span><span class="p">).</span><span class="n">_text</span> <span class="p">==</span> <span class="n">_text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">GetHashCode</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">unchecked</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">hash</span> <span class="p">=</span> <span class="m">17</span><span class="p">;</span>
            <span class="n">hash</span> <span class="p">=</span> <span class="n">hash</span> <span class="p">*</span> <span class="m">23</span> <span class="p">+</span> <span class="n">_text</span><span class="p">.</span><span class="nf">GetHashCode</span><span class="p">();</span>
            <span class="k">return</span> <span class="n">hash</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The name just need to be a string. We could change it to be more restrictive.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Name</span> <span class="p">:</span> <span class="n">IEquatable</span><span class="p">&lt;</span><span class="n">Name</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">_text</span><span class="p">;</span>

    <span class="k">private</span> <span class="nf">Name</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">Name</span><span class="p">(</span><span class="kt">string</span> <span class="n">text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NameShouldNotBeEmptyException</span><span class="p">(</span><span class="s">"The 'Name' field is required"</span><span class="p">);</span>

        <span class="n">_text</span> <span class="p">=</span> <span class="n">text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">string</span> <span class="nf">ToString</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">ReferenceEquals</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nf">ReferenceEquals</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="k">is</span> <span class="kt">string</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">obj</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">==</span> <span class="n">_text</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">((</span><span class="n">Name</span><span class="p">)</span> <span class="n">obj</span><span class="p">).</span><span class="n">_text</span> <span class="p">==</span> <span class="n">_text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">GetHashCode</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">unchecked</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">hash</span> <span class="p">=</span> <span class="m">17</span><span class="p">;</span>
            <span class="n">hash</span> <span class="p">=</span> <span class="n">hash</span> <span class="p">*</span> <span class="m">23</span> <span class="p">+</span> <span class="n">_text</span><span class="p">.</span><span class="nf">GetHashCode</span><span class="p">();</span>
            <span class="k">return</span> <span class="n">hash</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">Name</span> <span class="n">other</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">_text</span> <span class="p">==</span> <span class="n">other</span><span class="p">.</span><span class="n">_text</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The amount should be positive.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">PositiveAmount</span> <span class="p">:</span> <span class="n">IEquatable</span><span class="p">&lt;</span><span class="n">PositiveAmount</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Amount</span> <span class="n">_value</span><span class="p">;</span>

    <span class="k">private</span> <span class="nf">PositiveAmount</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">PositiveAmount</span><span class="p">(</span><span class="kt">double</span> <span class="k">value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">value</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">AmountShouldBePositiveException</span><span class="p">(</span><span class="s">"The 'Amount' should be positive."</span><span class="p">);</span>

        <span class="n">_value</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Amount</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">ReferenceEquals</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nf">ReferenceEquals</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="k">is</span> <span class="kt">double</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">obj</span> <span class="p">==</span> <span class="n">_value</span><span class="p">.</span><span class="nf">ToDouble</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">((</span><span class="n">PositiveAmount</span><span class="p">)</span> <span class="n">obj</span><span class="p">).</span><span class="n">_value</span> <span class="p">==</span> <span class="n">_value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">Amount</span> <span class="nf">ToAmount</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">internal</span> <span class="n">PositiveAmount</span> <span class="nf">Add</span><span class="p">(</span><span class="n">PositiveAmount</span> <span class="n">positiveAmount</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_value</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">positiveAmount</span><span class="p">.</span><span class="n">_value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">GetHashCode</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">unchecked</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">hash</span> <span class="p">=</span> <span class="m">17</span><span class="p">;</span>
            <span class="n">hash</span> <span class="p">=</span> <span class="n">hash</span> <span class="p">*</span> <span class="m">23</span> <span class="p">+</span> <span class="n">_value</span><span class="p">.</span><span class="nf">GetHashCode</span><span class="p">();</span>
            <span class="k">return</span> <span class="n">hash</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">internal</span> <span class="n">Amount</span> <span class="nf">Subtract</span><span class="p">(</span><span class="n">PositiveAmount</span> <span class="n">positiveAmount</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_value</span><span class="p">.</span><span class="nf">Subtract</span><span class="p">(</span><span class="n">positiveAmount</span><span class="p">.</span><span class="n">_value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">PositiveAmount</span> <span class="n">other</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">_value</span> <span class="p">==</span> <span class="n">other</span><span class="p">.</span><span class="n">_value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-validating-fields-format-in-the-domain-layer">3. Validating fields format in the Domain Layer</h3>

<p>The use cases accept Input messages and are made of Value Objects.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">RegisterInput</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">SSN</span> <span class="n">SSN</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">Name</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">PositiveAmount</span> <span class="n">InitialAmount</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">RegisterInput</span><span class="p">(</span><span class="n">SSN</span> <span class="n">ssn</span><span class="p">,</span> <span class="n">Name</span> <span class="n">name</span><span class="p">,</span> <span class="n">PositiveAmount</span> <span class="n">initialAmount</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ssn</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">InputValidationException</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">ssn</span><span class="p">)}</span><span class="s"> cannot be null."</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">InputValidationException</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">name</span><span class="p">)}</span><span class="s"> cannot be null."</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">initialAmount</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">InputValidationException</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">initialAmount</span><span class="p">)}</span><span class="s"> cannot be null."</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">SSN</span> <span class="p">=</span> <span class="n">ssn</span><span class="p">;</span>
        <span class="n">Name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="n">InitialAmount</span> <span class="p">=</span> <span class="n">initialAmount</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="how-i-use-it">How I use it?</h2>

<p>In the Web Layer the controller has an action that requires a <code class="highlighter-rouge">RegisterRequest</code> object, the action is responsible for creating the RegisterInput object then calling the use case.</p>

<ul>
  <li>The interesting about Request/Response objects is that they are made of serializable objects (eg. <code class="highlighter-rouge">int</code>, <code class="highlighter-rouge">double</code> and <code class="highlighter-rouge">string</code>).</li>
  <li>The Request/Response are responsible for carrying the data from and back to the User.</li>
  <li>Of course you can’t trust it, you need to create Input objects.</li>
</ul>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// Register a customer</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="c1">/// &lt;response code="200"&gt;The registered customer was create successfully.&lt;/response&gt;</span>
<span class="c1">/// &lt;response code="400"&gt;Bad request.&lt;/response&gt;</span>
<span class="c1">/// &lt;response code="500"&gt;Error.&lt;/response&gt;</span>
<span class="c1">/// &lt;param name="request"&gt;The request to register a customer&lt;/param&gt;</span>
<span class="c1">/// &lt;returns&gt;The newly registered customer&lt;/returns&gt;</span>
<span class="na">[HttpPost]</span>
<span class="na">[ProducesResponseType(StatusCodes.Status200OK, Type = typeof(RegisterResponse))]</span>
<span class="na">[ProducesResponseType(StatusCodes.Status400BadRequest)]</span>
<span class="na">[ProducesResponseType(StatusCodes.Status500InternalServerError)]</span>
<span class="na">[SwaggerRequestExample(typeof(RegisterRequest), typeof(GetCustomerDetailsRequestExample))]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">Post</span><span class="p">([</span><span class="n">FromBody</span><span class="p">][</span><span class="n">Required</span><span class="p">]</span> <span class="n">RegisterRequest</span> <span class="n">request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">input</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RegisterInput</span><span class="p">(</span>
        <span class="k">new</span> <span class="nf">SSN</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">SSN</span><span class="p">),</span>
        <span class="k">new</span> <span class="nf">Name</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">Name</span><span class="p">),</span>
        <span class="k">new</span> <span class="nf">PositiveAmount</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">InitialAmount</span><span class="p">));</span>

    <span class="k">await</span> <span class="n">_registerUseCase</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">_presenter</span><span class="p">.</span><span class="n">ViewModel</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The beautiful of this approach is that the use cases can use Input objects and read the Value Objects which are always valid.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Register</span> <span class="p">:</span> <span class="n">IUseCase</span>
<span class="p">{</span>
    <span class="c1">// code ommited for simplication</span>

    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Execute</span><span class="p">(</span><span class="n">RegisterInput</span> <span class="n">input</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">input</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_outputHandler</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">"Input is null."</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">var</span> <span class="n">customer</span> <span class="p">=</span> <span class="n">_entityFactory</span><span class="p">.</span><span class="nf">NewCustomer</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">SSN</span><span class="p">,</span> <span class="n">input</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">account</span> <span class="p">=</span> <span class="n">_entityFactory</span><span class="p">.</span><span class="nf">NewAccount</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>

        <span class="n">ICredit</span> <span class="n">credit</span> <span class="p">=</span> <span class="n">account</span><span class="p">.</span><span class="nf">Deposit</span><span class="p">(</span><span class="n">_entityFactory</span><span class="p">,</span> <span class="n">input</span><span class="p">.</span><span class="n">InitialAmount</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">credit</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_outputHandler</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">"An error happened when depositing the amount."</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">customer</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="n">account</span><span class="p">);</span>

        <span class="k">await</span> <span class="n">_customerRepository</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
        <span class="k">await</span> <span class="n">_accountRepository</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">credit</span><span class="p">);</span>
        <span class="k">await</span> <span class="n">_unitOfWork</span><span class="p">.</span><span class="nf">Save</span><span class="p">();</span>

        <span class="n">RegisterOutput</span> <span class="n">output</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RegisterOutput</span><span class="p">(</span><span class="n">customer</span><span class="p">,</span> <span class="n">account</span><span class="p">);</span>
        <span class="n">_outputHandler</span><span class="p">.</span><span class="nf">Standard</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Value Objects are powerful, you can use them everywhere in the Application/Domain layers and you know there are valid.</p>

<h2 id="throwing-and-catching-exceptions">Throwing and Catching Exceptions</h2>

<p>You saw previously that the validation logic is throwing exceptions, so we need to catch them somewhere. I suggest you to add a filter on the Web layer and all Domain Exceptions are returned as <code class="highlighter-rouge">BadRequest</code> objects.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">BusinessExceptionFilter</span> <span class="p">:</span> <span class="n">IExceptionFilter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">OnException</span><span class="p">(</span><span class="n">ExceptionContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">DomainException</span> <span class="n">domainException</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Exception</span> <span class="k">as</span> <span class="n">DomainException</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">domainException</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">problemDetails</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProblemDetails</span>
            <span class="p">{</span>
                    <span class="n">Status</span> <span class="p">=</span> <span class="m">400</span><span class="p">,</span>
                    <span class="n">Title</span> <span class="p">=</span> <span class="s">"Bad Request"</span><span class="p">,</span>
                    <span class="n">Detail</span> <span class="p">=</span> <span class="n">domainException</span><span class="p">.</span><span class="n">Message</span>
            <span class="p">};</span>

            <span class="n">context</span><span class="p">.</span><span class="n">Result</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BadRequestObjectResult</span><span class="p">(</span><span class="n">problemDetails</span><span class="p">);</span>
            <span class="n">context</span><span class="p">.</span><span class="n">Exception</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="testing">Testing</h2>

<p>You can test from different perspectives. I would prioritize testing the Input objects from Unit Tests.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="rouge-code"><pre><span class="na">[Fact]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">GivenNullSSN_InputNotCreated_ThrowsInputValidationException</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">actualEx</span> <span class="p">=</span> <span class="n">Assert</span><span class="p">.</span><span class="n">Throws</span><span class="p">&lt;</span><span class="n">InputValidationException</span><span class="p">&gt;(</span>
        <span class="p">()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">RegisterInput</span><span class="p">(</span>
            <span class="k">null</span><span class="p">,</span>
            <span class="k">new</span> <span class="nf">Name</span><span class="p">(</span><span class="s">"Ivan"</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">PositiveAmount</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
        <span class="p">));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"ssn"</span><span class="p">,</span> <span class="n">actualEx</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">GivenNullName_InputNotCreated_ThrowsInputValidationException</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">actualEx</span> <span class="p">=</span> <span class="n">Assert</span><span class="p">.</span><span class="n">Throws</span><span class="p">&lt;</span><span class="n">InputValidationException</span><span class="p">&gt;(</span>
        <span class="p">()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">RegisterInput</span><span class="p">(</span>
            <span class="k">new</span> <span class="nf">SSN</span><span class="p">(</span><span class="s">"19860817999"</span><span class="p">),</span>
            <span class="k">null</span><span class="p">,</span>
            <span class="k">new</span> <span class="nf">PositiveAmount</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
        <span class="p">));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="n">actualEx</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">GivenNullPositiveAmount_InputNotCreated_ThrowsInputValidationException</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">actualEx</span> <span class="p">=</span> <span class="n">Assert</span><span class="p">.</span><span class="n">Throws</span><span class="p">&lt;</span><span class="n">InputValidationException</span><span class="p">&gt;(</span>
        <span class="p">()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">RegisterInput</span><span class="p">(</span>
            <span class="k">new</span> <span class="nf">SSN</span><span class="p">(</span><span class="s">"19860817999"</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">Name</span><span class="p">(</span><span class="s">"Ivan"</span><span class="p">),</span>
            <span class="k">null</span>
        <span class="p">));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"initialAmount"</span><span class="p">,</span> <span class="n">actualEx</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[Fact]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">GivenValidData_InputCreated</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">actual</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RegisterInput</span><span class="p">(</span>
        <span class="k">new</span> <span class="nf">SSN</span><span class="p">(</span><span class="s">"19860817999"</span><span class="p">),</span>
        <span class="k">new</span> <span class="nf">Name</span><span class="p">(</span><span class="s">"Ivan"</span><span class="p">),</span>
        <span class="k">new</span> <span class="nf">PositiveAmount</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
    <span class="p">);</span>
    <span class="n">Assert</span><span class="p">.</span><span class="nf">NotNull</span><span class="p">(</span><span class="n">actual</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="my-thoughts-on-fluent-validation">My Thoughts on Fluent Validation</h2>

<p>I see FluentValidation perfect fit for objects validation that I have not control on design. Suppose that I need to consume a old WCF service and the message has constraints on it.</p>

<p>I would implement a custom FluentValidator on the infrastructure layer.</p>

<p>I would not use it for Value Objects amd Input Messages validation.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Use the frameworks with cautions, implement the business validation inside the Domain and clean up fat methods replacing primitive objects with proper Value Objects.</p>

<p>Want to see it in action? The demo is running on Heroku:</p>

<p><a href="https://clean-architecture-manga.herokuapp.com/swagger/index.html"><img src="/assets/images/clean-architecture-manga-swagger.png" alt="Clean Architecture Manga Swagger" /></a></p>

<p>Happy Codding!</p>

<p>Do you agree/disagree?</p>

            </div>

            <!-- Rating -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2019-09-07">07 Sep 2019</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#cleanarchitecture">cleanarchitecture</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#ddd">ddd</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#tdd">tdd</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#validation">validation</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="//clean-architecture-essentials-part-1/"> &laquo; Clean Architecture Essentials - Part I</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="//tdd-hexagonal-architecture-video/">TDD and Hexagonal Architecture Video &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'paulovichdotnet'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

</div>


<!-- Bottom Alert Bar
================================================== -->
<div class="alertbar">
	<div class="container text-center">
		<span><img src="/assets/images/logo.png" alt="Software Architecture and .NET Development"> &nbsp; Never miss a <b>story</b> from us, subscribe to our newsletter</span>
        <form action="https://paulovich.us3.list-manage.com/subscribe/post?u=3908a479dc89ce5adc26cc8c5&amp;id=9275121da4" method="post" name="mc-embedded-subscribe-form" class="wj-contact-form validate" target="_blank" novalidate>
            <div class="mc-field-group">
            <input type="email" placeholder="Email" name="EMAIL" class="required email" id="mce-EMAIL" autocomplete="on" required>
            <input type="submit" value="Subscribe" name="subscribe" class="heart">
            </div>
        </form>
	</div>
</div>

    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/category/cleanarchitecture">cleanarchitecture (11)</a>
                
                    <a class="mt-1 mb-1" href="/category/ddd">ddd (3)</a>
                
                    <a class="mt-1 mb-1" href="/category/video">video (3)</a>
                
                    <a class="mt-1 mb-1" href="/category/tdd">tdd (4)</a>
                
                    <a class="mt-1 mb-1" href="/category/validation">validation (1)</a>
                
                    <a class="mt-1 mb-1" href="/category/hexagonalarchitecture">hexagonalarchitecture (1)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2019 Paulovich.NET 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>


<script src="/assets/js/lazyload.js"></script>


<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//paulovichdotnet.disqus.com/count.js"></script>


</body>
</html>
